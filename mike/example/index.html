<!DOCTYPE html>
<meta charset="utf-8">
<title>For Example</title>
<style>

@import url(../style.css?20130411);

.slide {
  margin: 2em 0 2em 0;
}

.slide iframe {
  border: solid 1px #ccc;
}

</style>

<header>
  <aside>June 7, 2013</aside>
  <a href="../" rel="author">Mike Bostock</a>
</header>

<h1>For Example</h1>

<p class="slide"><a href="http://bl.ocks.org/mbostock" target="_blank"><img src="montage.png" width="960" height="512"></a>

<aside>This is a rough transcript of my talk on June 6, 2013 at <a href="http://eyeofestival.com/">Eyeo</a>. Words and examples have been adapted a bit for the web so may differ slightly from the talk.</aside>

<p>I am a big fan of examples. Not a surprise, right? If you follow me on <a href="https://twitter.com/mbostock">Twitter</a>, or my projects over the last few years (or asked D3 questions on Stack Overflow), you’ve likely seen some of my example visualizations, maps and explanations.

<p>My love for examples is so deep that I created a website dedicated to sharing them: <a href="http://bl.ocks.org">bl.ocks.org</a> lets you quickly post code and share your example with a short URL. Your code is displayed below the example; it’s view source by default. And it’s backed by <a href="https://gist.github.com">GitHub Gist</a>, so examples have a git repository for version control, and are forkable, cloneable and commentable.

<p>I initially conceived this talk as an excuse to show all my examples. But with more than 600, I’d have only 4.5 seconds per. And that would be overwhelming. So instead I’ve picked a few favorites that I hope you’ll enjoy. You should find this talk entertaining, even if it fails to be insightful.

<p>But this talk has a point, too. Examples are lightweight and informal. They can often be made in a few minutes. They lack the ceremony of polished graphics or official tools. Yet they are a powerful medium of communication, capable of expressing big ideas with immediate impact. And Eyeo is a unique opportunity for me to talk directly to all of you that are doing amazing things with code, data and visualization. So, <b>if I can accomplish one thing here, it should be to get you to share more examples</b>. In short, to share my love of examples with you.

<h2><a href="#1" name="1">#</a>The Flawed Example</h2>

<p>So let’s start with an example, shall we? (An example of an example; a meta-example.) This is one of my favorites, but it’s also flawed in a way that is representative, making it a good candidate for dissection and self-critique.

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/3795544/" width="960" height="580" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/3795544" target="_blank">bl.ocks.org/3795544</a></aside>

<p>This is an example I wrote to demonstrate a new feature in D3. The <a href="https://github.com/mbostock/d3/wiki/3.0">3.0 release</a> included major improvements to our geographic projection system, work that was done with my co-author, the brilliant <a href="http://jasondavies.com">Jason Davies</a>.

<p>One challenge in map projection is that input geometry—coast lines, country borders and such—are defined as polygons. When polygons are projected from the sphere to the screen, the edges may no longer be straight lines due to distortion in the projection. And the fact that edges are not straight to begin with: spherical polygon edges are great arcs, not lines. So on the left you see what happens if you represent the equator as a polyline with a point every 90°. When projected point-by-point, the line appears broken because five points are not enough to produce a smooth curve.

<p>The conventional fix is to use more points. The middle diagrams shows a point every 4° of longitude. As you can see, this is better. But if you look closely you can still see artifacts on the vertical lines where the distortion is so severe that even 4° is not enough! And you can see many points along the horizontal lines where there is little distortion; these points do not improve quality, but slow down rendering. So uniform resampling is inefficient and doesn’t guarantee great results.

<p>Our solution is on the right. We detect places of high curvature and introduce additional points just in those places. This gives beautiful results even in areas of high distortion, and performs well because we only add points where they are needed.

<p>Now, I said this example was flawed. If I weren’t now explaining it, you could easily be scratching your head, wondering what you were looking at. Not every viewer will be sufficiently familiar with map projections to understand the problem or the proposed solution. So obviously the first step in any example is to <b>know your audience</b> and <b>communicate in a way that is accessible</b> to them.

<p>So what are we looking at?

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/5731578/" width="960" height="500" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/5731578" target="_blank">bl.ocks.org/5731578</a></aside>

<p>The gray lines of constant latitude and longitude, called parallels and meridians, form a graticule. The red parallel bisecting this spherical grid at 0° latitude is the equator.

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/5731632/" width="960" height="500" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/5731632" target="_blank">bl.ocks.org/5731632</a></aside>

<p>Then we took the sphere and projected it down to the plane with our map projection. Specifically, the equirectangular or plate carrée projection, which is the simplest type of projection there is. Longitude runs along the <i>x</i>-axis and latitude along the <i>y</i>-axis.

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/5731693/" width="960" height="580" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/5731693" target="_blank">bl.ocks.org/5731693</a></aside>

<p>In the normal aspect of the equirectangular projection—that is, without any rotation—the equator is a straight line. But now we rotate the sphere by almost 90° along one axis. We also rotated the display by the reverse 90° so that the poles remain vertically aligned. This rotation is called a transverse aspect. So now you have a better sense of what you’re looking at.

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/5731808/" width="960" height="580" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/5731808" target="_blank">bl.ocks.org/5731808</a></aside>

<p>The name of this special case of the equirectangular projection is the Cassini projection after the French cartographer and astronomer. (The grandson of the Cassini that first observed Saturn’s moons, and the Cassini division in Saturn’s rings.) There’s not much use for this projection today, as it has been largely replaced by the transverse Mercator for low-distortion maps of narrow regions.

<p>None of this is relevant to understanding the example, by the way, I’m only mentioning it because the history of cartography is fascinating, and map projections are so numerous and beautiful. I used the Cassini projection in this example only because it heavily distorts the equator and it is easy to fit three of them side-by-side.

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/5699934/" width="960" height="500" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/5699934" target="_blank">bl.ocks.org/5699934</a></aside>

<p>OK, now that you understand the display, you can see what adaptive resampling does. But how does it work? Well, it recursively subdivides the input polygon (or polyline in this case). Each adjacent pair of points forms a great arc segment; you find the midpoint of this great arc and project it. This midpoint is shown in black. Then you measure the perpendicular distance from this midpoint to the straight line between the two projected endpoints. This is the estimation of curvature, or distortion. If the distance is large, then this edge has high curvature and it’s worthwhile to continue resampling. On the other hand if the area is small, then the projected line is approximately straight, so there’s no need for more samples. Hence the term “adaptive”: only resample where needed.

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/5731979/" width="960" height="500" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/5731979" target="_blank">bl.ocks.org/5731979</a></aside>

<p>Scale-dependent metric…

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/5732029/" width="960" height="600" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/5732029" target="_blank">bl.ocks.org/5732029</a></aside>

<p>The resampling algorithm is in essence the reverse of the Douglas–Peucker line simplification algorithm. Rather than remove detail, we preserve detail that would be lost when projected.

<p>You have much more context now, so let’s take another look.

<p class="slide"><iframe data-src="http://bl.ocks.org/mbostock/raw/3795544/" width="960" height="580" marginwidth="0" marginheight="0" scrolling="no"></iframe>

<aside><a href="http://bl.ocks.org/mbostock/3795544" target="_blank">bl.ocks.org/3795544</a></aside>

<p>Notice the clustering of points in the corners, where the equator is stretched and curved. If you are wondering, the graticules in all three views are rendered with adaptive resampling, which is why the graticule always looks good! Remember the graticule is itself a polygon. Everything is a polygon! This is done automatically as part of D3’s projection pipeline.

<p>I think that’s a cool algorithm. It’s neat, right? Particularly the symmetry with line simplification. But I was so excited to tell you how cool the algorithm was, I forgot to explain why it matters. The example illustrates what the feature does, but not why the feature exists. So the example only resonates for viewers that already understand the feature’s utility. <b>If you want your example to speak to people other than yourself, you have to explain why it matters.</b>

<p>So how do we address this flaw? We show applications that the feature enables. Preferrably, concrete examples that are representative of real-world usage.

<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var iframe = d3.selectAll(".slide iframe[data-src]").datum(function() {
  return {
    visible: false,
    src: this.getAttribute("data-src")
  };
});

d3.select(window)
    .on("scroll", scrolled)
    .on("resize", scrolled);

function scrolled() {
  var height = window.innerHeight || document.documentElement.clientHeight;
  iframe.filter(function(d) {
    var visible0 = d.visible, box = this.getBoundingClientRect();
    d.visible = !(box.bottom < 0 || box.top > height);
    return visible0 !== d.visible;
  }).attr("src", function(d) {
    return d.visible ? d.src : null;
  });
}

</script>

<footer>
  <aside>June 7, 2013</aside>
  <a href="../" rel="author">Mike Bostock</a>
</footer>

<script src="../highlight.min.js"></script>
